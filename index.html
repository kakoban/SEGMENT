<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ØªÙˆÙ„ÛŒØ¯ Ø³Ú¯Ù…Ù†Øª - Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #EBF4FF 0%, #E0E7FF 100%); min-height: 100vh; padding: 1rem;}
        .container {max-width: 1200px; margin: 0 auto;}
        .header {background: linear-gradient(to left, #DC2626 0%, #B91C1C 100%); color: white; border-radius: 1rem 1rem 0 0; padding: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.15);}
        .header-content {display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap;}
        .header-title {display: flex; align-items: center; gap: 0.75rem;}
        .header h1 {font-size: 1.5rem; font-weight: bold;}
        .header p {color: #FEE2E2; font-size: 0.875rem; margin-top: 0.25rem;}
        .badge {background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.75rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;}
        .badge:hover {background: rgba(255,255,255,0.3);}
        .badge.success {background: rgba(16, 185, 129, 0.3);}
        .icon {width: 2rem; height: 2rem; stroke: currentColor; stroke-width: 2; fill: none;}
        .form-container {background: white; border-radius: 0 0 1rem 1rem; padding: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.1);}
        .section {margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px solid #E5E7EB;}
        .section:last-of-type {border-bottom: none;}
        .section-title {font-size: 1.125rem; font-weight: bold; color: #1F2937; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;}
        .grid {display: grid; gap: 1rem; grid-template-columns: 1fr;}
        @media (min-width: 768px) {.grid {grid-template-columns: repeat(2, 1fr);} .form-container {padding: 2.5rem;}}
        .form-group {display: flex; flex-direction: column;}
        label {font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;}
        input, textarea, select {padding: 0.75rem 1rem; border: 2px solid #D1D5DB; border-radius: 0.5rem; font-size: 1rem; transition: all 0.2s; font-family: inherit;}
        input:focus, textarea:focus, select:focus {outline: none; border-color: #6366F1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);}
        textarea {resize: vertical; min-height: 100px;}
        .info-box {background: #F0F9FF; border: 2px solid #3B82F6; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem;}
        .info-box.warning {background: #FEF3C7; border-color: #F59E0B;}
        .info-box.success {background: #D1FAE5; border-color: #10B981;}
        .info-box h3 {font-size: 0.875rem; font-weight: bold; color: #1E40AF; margin-bottom: 0.5rem;}
        .info-box.warning h3 {color: #92400E;}
        .info-box.success h3 {color: #065F46;}
        .info-table {width: 100%; border-collapse: collapse; font-size: 0.875rem;}
        .info-table td {padding: 0.5rem; border-bottom: 1px solid #BFDBFE;}
        .info-table td:first-child {font-weight: 600; color: #1E40AF;}
        .info-table tr:last-child td {border-bottom: none;}
        .stock-display {display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.75rem; margin-top: 1rem;}
        .stock-item {background: #F9FAFB; border: 2px solid #E5E7EB; border-radius: 0.5rem; padding: 0.75rem; text-align: center; transition: all 0.3s;}
        .stock-item-title {font-size: 0.75rem; color: #6B7280; margin-bottom: 0.25rem;}
        .stock-item-value {font-size: 1.25rem; font-weight: bold; color: #1F2937; margin: 0.25rem 0;}
        .stock-item-detail {font-size: 0.7rem; color: #9CA3AF;}
        .stock-item.low {background: #FEF2F2; border-color: #FCA5A5;}
        .stock-item.low .stock-item-value {color: #DC2626;}
        .stock-item.warning {background: #FEF3C7; border-color: #FCD34D;}
        .stock-item.warning .stock-item-value {color: #D97706;}
        .button-group {display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 0.75rem; margin-top: 2rem;}
        button {padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-size: 0.9rem; font-weight: bold; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);}
        button:hover:not(:disabled) {transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15);}
        button:disabled {opacity: 0.6; cursor: not-allowed; transform: none;}
        .btn-save {background: linear-gradient(to left, #10B981 0%, #059669 100%); color: white;}
        .btn-load {background: linear-gradient(to left, #3B82F6 0%, #2563EB 100%); color: white;}
        .btn-copy {background: linear-gradient(to left, #6366F1 0%, #4F46E5 100%); color: white;}
        .btn-download {background: linear-gradient(to left, #059669 0%, #047857 100%); color: white;}
        .btn-history {background: linear-gradient(to left, #F59E0B 0%, #D97706 100%); color: white;}
        .btn-settings {background: linear-gradient(to left, #8B5CF6 0%, #7C3AED 100%); color: white;}
        .btn-danger {background: linear-gradient(to left, #EF4444 0%, #DC2626 100%); color: white;}
        .preview {margin-top: 2rem; padding: 1rem; background: #F9FAFB; border: 2px solid #E5E7EB; border-radius: 0.5rem;}
        .preview h3 {font-size: 0.875rem; font-weight: bold; color: #374151; margin-bottom: 0.75rem;}
        .preview pre {font-size: 0.75rem; color: #1F2937; white-space: pre-wrap; word-wrap: break-word; font-family: 'Courier New', monospace; line-height: 1.6;}
        .alert {position: fixed; top: 2rem; left: 50%; transform: translateX(-50%) translateY(-100px); background: #10B981; color: white; padding: 1rem 2rem; border-radius: 0.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); opacity: 0; transition: all 0.3s; z-index: 1000; font-weight: bold;}
        .alert.show {transform: translateX(-50%) translateY(0); opacity: 1;}
        .alert.error {background: #EF4444;}
        .alert.warning {background: #F59E0B;}
        .modal {display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; padding: 1rem;}
        .modal.show {display: flex;}
        .modal-content {background: white; border-radius: 1rem; padding: 2rem; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto;}
        .modal-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #E5E7EB;}
        .modal-header h2 {font-size: 1.25rem; color: #1F2937;}
        .modal-close {background: #EF4444; color: white; border: none; border-radius: 0.375rem; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.875rem; font-weight: bold;}
        .settings-group {margin-bottom: 1.5rem;}
        .settings-group h3 {font-size: 1rem; font-weight: bold; color: #374151; margin-bottom: 0.75rem;}
        .settings-item {display: grid; grid-template-columns: 2fr 1fr; gap: 0.5rem; align-items: center; margin-bottom: 0.5rem;}
        .settings-item label {margin: 0;}
        .settings-item input {padding: 0.5rem;}
        .history-list {max-height: 400px; overflow-y: auto;}
        .history-item {background: #F9FAFB; border: 2px solid #E5E7EB; border-radius: 0.5rem; padding: 1rem; margin-bottom: 0.75rem; cursor: pointer; transition: all 0.2s;}
        .history-item:hover {border-color: #6366F1; background: #EEF2FF;}
        .history-item.current {border-color: #10B981; background: #D1FAE5;}
        .history-date {font-weight: bold; color: #1F2937; margin-bottom: 0.5rem;}
        .history-info {font-size: 0.875rem; color: #6B7280; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem;}
        .calendar {display: none; position: absolute; top: 100%; left: 0; right: 0; margin-top: 0.5rem; background: white; border: 2px solid #6366F1; border-radius: 0.75rem; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 100; padding: 1rem;}
        .calendar.show {display: block;}
        .calendar-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 2px solid #E5E7EB;}
        .calendar-header button {padding: 0.5rem 1rem; background: #6366F1; color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; box-shadow: none; font-weight: bold;}
        .calendar-header button:hover {background: #4F46E5; transform: none;}
        .calendar-title {font-weight: bold; color: #1F2937; font-size: 1rem;}
        .calendar-weekdays {display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem; margin-bottom: 0.5rem;}
        .calendar-weekday {text-align: center; font-size: 0.75rem; font-weight: bold; color: #6B7280; padding: 0.5rem;}
        .calendar-days {display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem;}
        .calendar-day {aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s; border: 1px solid transparent;}
        .calendar-day:hover {background: #EEF2FF; border-color: #6366F1;}
        .calendar-day.selected {background: #6366F1; color: white; font-weight: bold;}
        .calendar-day.today {border: 2px solid #10B981; font-weight: bold;}
        .calendar-day.other-month {color: #D1D5DB;}
        @media (max-width: 640px) {.calendar {position: fixed; top: 50%; left: 1rem; right: 1rem; margin-top: 0; transform: translateY(-50%);}}
    </style>
</head>
<body>
    <div class="alert" id="alert">Ú¯Ø²Ø§Ø±Ø´ Ú©Ù¾ÛŒ Ø´Ø¯! âœ“</div>
    
    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
                <button class="modal-close" onclick="closeSettings()">Ø¨Ø³ØªÙ†</button>
            </div>
            
            <div class="settings-group">
                <h3>ğŸ“Š Ù…ØµØ±Ù Ù…ÛŒÙ„Ú¯Ø±Ø¯ (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù… Ø¯Ø± Ø±ÛŒÙ†Ú¯)</h3>
                <div class="settings-item">
                    <label>Ø¢Ø±Ù…Ø§ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡ Û¸</label>
                    <input type="number" id="setting_rebar8" value="736">
                </div>
                <div class="settings-item">
                    <label>Ø¢Ø±Ù…Ø§ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡ Û±Û²</label>
                    <input type="number" id="setting_rebar12" value="758">
                </div>
                <div class="settings-item">
                    <label>Ø¢Ø±Ù…Ø§ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡ Û²Û°</label>
                    <input type="number" id="setting_rebar20" value="250">
                </div>
            </div>

            <div class="settings-group">
                <h3>ğŸ§ª Ù…ØµØ±Ù Ø§ÙØ²ÙˆØ¯Ù†ÛŒ (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù… Ø¯Ø± Ø±ÛŒÙ†Ú¯)</h3>
                <div class="settings-item">
                    <label>Ø§ÙØ²ÙˆØ¯Ù†ÛŒ (ÙÙˆÙ‚ Ø±ÙˆØ§Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡)</label>
                    <input type="number" id="setting_superplasticizer" value="45">
                </div>
            </div>

            <div class="settings-group">
                <h3>ğŸ’¾ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</h3>
                <div class="settings-item">
                    <label>Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡</label>
                    <input type="number" id="setting_maxHistory" value="30" min="10" max="100">
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label>Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚Ø¨Ù„ Ø§Ø² Ø°Ø®ÛŒØ±Ù‡</label>
                    <select id="setting_autoBackup">
                        <option value="true">ÙØ¹Ø§Ù„</option>
                        <option value="false">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
                    </select>
                </div>
            </div>

            <button class="btn-copy" onclick="saveSettings()" style="width: 100%; margin-top: 1rem;">
                âœ“ Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            </button>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</h2>
                <button class="modal-close" onclick="closeHistory()">Ø¨Ø³ØªÙ†</button>
            </div>
            
            <div class="info-box warning">
                <h3>âš ï¸ ØªÙˆØ¬Ù‡</h3>
                <p style="font-size: 0.875rem; color: #92400E;">Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù‡Ø± Ú¯Ø²Ø§Ø±Ø´ØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ù† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ù„ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
            </div>
            
            <div class="history-list" id="historyList">
                <p style="text-align: center; color: #6B7280; padding: 2rem;">Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ Ù‚Ø¨Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
            </div>
            
            <div class="button-group" style="margin-top: 1rem;">
                <button class="btn-danger" onclick="clearHistory()">
                    ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡
                </button>
                <button class="btn-download" onclick="exportHistory()">
                    ğŸ“¥ ØµØ§Ø¯Ø±Ø§Øª ØªØ§Ø±ÛŒØ®Ú†Ù‡
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    <div>
                        <h1>Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ØªÙˆÙ„ÛŒØ¯ Ø³Ú¯Ù…Ù†Øª</h1>
                        <p>ğŸ”´ Ù¾Ø±ÙˆÚ˜Ù‡ Ø®Ø· Û±Û° Ù…ØªØ±Ùˆ ØªÙ‡Ø±Ø§Ù† - Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</p>
                    </div>
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <div class="badge" onclick="setToday()" id="todayBadge">ğŸ“… Ø§Ù…Ø±ÙˆØ²</div>
                    <div class="badge success" id="backupBadge">ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÙØ¹Ø§Ù„</div>
                </div>
            </div>
        </div>

        <div class="form-container">
            <!-- Warning Box -->
            <div class="info-box warning" id="warningBox" style="display: none;">
                <h3>âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: ØªØºÛŒÛŒØ±Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡</h3>
                <p style="font-size: 0.875rem; color: #92400E;">ØªØºÛŒÛŒØ±Ø§Øª Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø³ØªÙ† ØµÙØ­Ù‡ Ø­ØªÙ…Ø§Ù‹ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯.</p>
            </div>

            <!-- Success Box -->
            <div class="info-box success" id="successBox" style="display: none;">
                <h3>âœ“ Ø¢Ø®Ø±ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡</h3>
                <p style="font-size: 0.875rem; color: #065F46;" id="lastSaveInfo">Ù‡Ù†ÙˆØ² Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯Ù‡</p>
            </div>

            <!-- ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´ -->
            <div class="section">
                <h2 class="section-title">
                    ğŸ“… ØªØ§Ø±ÛŒØ® Ú¯Ø²Ø§Ø±Ø´
                </h2>
                <div class="grid">
                    <div class="form-group">
                        <label>ØªØ§Ø±ÛŒØ® (Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯)</label>
                        <div style="position: relative;">
                            <input type="text" id="reportDate" value="" readonly style="cursor: pointer; background: white;">
                            <div id="calendar" class="calendar"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Ø±ÙˆØ²</label>
                        <input type="text" id="dayName" value="" readonly style="background: #F3F4F6;">
                    </div>
                </div>
            </div>

            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙˆÙ„ÛŒØ¯ -->
            <div class="section">
                <h2 class="section-title">
                    ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙˆÙ„ÛŒØ¯
                </h2>

                <div class="info-box">
                    <h3>ğŸ“Œ Ù…ØµØ±Ù Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø± Ù‡Ø± Ø±ÛŒÙ†Ú¯</h3>
                    <table class="info-table">
                        <tr><td>Ø¢Ø±Ù…Ø§ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡ Û¸</td><td><span id="display_rebar8">Û·Û³Û¶</span> Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</td></tr>
                        <tr><td>Ø¢Ø±Ù…Ø§ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡ Û±Û²</td><td><span id="display_rebar12">Û·ÛµÛ¸</span> Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</td></tr>
                        <tr><td>Ø¢Ø±Ù…Ø§ØªÙˆØ± Ø´Ù…Ø§Ø±Ù‡ Û²Û°</td><td><span id="display_rebar20">Û²ÛµÛ°</span> Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</td></tr>
                        <tr><td>Ø§ÙØ²ÙˆØ¯Ù†ÛŒ (ÙÙˆÙ‚ Ø±ÙˆØ§Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡)</td><td><span id="display_superplasticizer">Û´Ûµ</span> Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</td></tr>
                    </table>
                </div>

                <div class="grid">
                    <div class="form-group">
                        <label>ØªÙˆÙ„ÛŒØ¯ Ø±ÙˆØ² (Ø±ÛŒÙ†Ú¯)</label>
                        <input type="number" id="ringsProduced" value="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Ø³Ø¨Ø¯ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ (Ø¨Ù‡ Ø±ÛŒÙ†Ú¯)</label>
                        <input type="number" id="basketsProduced" placeholder="â€”">
                    </div>
                    <div class="form-group">
                        <label>ØªÙˆÙ„ÛŒØ¯ Ù…Ø§Ù‡ (Ø±ÛŒÙ†Ú¯)</label>
                        <input type="number" id="monthlyProduction" value="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>ØªÙˆÙ„ÛŒØ¯ Ø³Ø§Ù„ Û±Û´Û°Û´ (Ø±ÛŒÙ†Ú¯)</label>
                        <input type="number" id="yearlyProduction" value="0" placeholder="0">
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>ØªÙˆÙ„ÛŒØ¯ ØªØ¬Ù…Ø¹ÛŒ Ú©Ù„ (Ø±ÛŒÙ†Ú¯)</label>
                        <input type="number" id="totalProduction" value="0" placeholder="0">
                    </div>
                </div>
            </div>

            <!-- Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡ -->
            <div class="section">
                <h2 class="section-title">
                    ğŸ“¦ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ù…ÙˆØ§Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
                </h2>
                <div class="grid">
                    <div class="form-group">
                        <label>Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ø´Ù…Ø§Ø±Ù‡ Û¸ (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)</label>
                        <input type="number" id="rebar8Stock" value="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ø´Ù…Ø§Ø±Ù‡ Û±Û² (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)</label>
                        <input type="number" id="rebar12Stock" value="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Ù…ÛŒÙ„Ú¯Ø±Ø¯ Ø´Ù…Ø§Ø±Ù‡ Û²Û° (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)</label>
                        <input type="number" id="rebar20Stock" value="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>ÙÙˆÙ‚ Ø±ÙˆØ§Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡ (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)</label>
                        <input type="number" id="superplasticizerStock" value="0" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Ù…ÛŒÚ©Ø±Ùˆ Ø³ÛŒÙ„ÛŒØ³ (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…)</label>
                        <input type="number" id="microsilicaStock" value="0" placeholder="0">
                    </div>
                </div>

                <h3 style="margin-top: 1.5rem; margin-bottom: 0.75rem; font-size: 1rem; color: #1F2937;">ğŸ’¡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¸Ø±ÙÛŒØª Ùˆ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡</h3>
                <div class="stock-display" id="stockDisplay"></div>
            </div>

            <!-- Ù…Ø´Ú©Ù„Ø§Øª Ùˆ Ù…ÙˆØ§Ù†Ø¹ -->
            <div class="section">
                <h2 class="section-title">
                    âš ï¸ Ù…Ø´Ú©Ù„Ø§Øª Ùˆ Ù…ÙˆØ§Ù†Ø¹
                </h2>
                <div class="form-group">
                    <textarea id="issues" placeholder="Ù…Ø´Ú©Ù„Ø§Øª Ùˆ Ù…ÙˆØ§Ù†Ø¹ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
                </div>
            </div>

            <!-- Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª -->
            <div class="section">
                <h2 class="section-title">
                    ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª
                </h2>
                <div class="form-group">
                    <textarea id="suggestions" placeholder="Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..."></textarea>
                </div>
            </div>

            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
            <div class="button-group">
                <button class="btn-settings" onclick="openSettings()">
                    âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                <button class="btn-history" onclick="openHistory()">
                    ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡
                </button>
                <button class="btn-save" onclick="saveWithBackup()" id="saveBtn">
                    ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø§Ù…Ù†
                </button>
                <button class="btn-copy" onclick="copyReport()">
                    ğŸ“‹ Ú©Ù¾ÛŒ
                </button>
                <button class="btn-download" onclick="downloadReport()">
                    ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯
                </button>
            </div>

            <!-- Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ -->
            <div class="preview">
                <h3>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´:</h3>
                <pre id="preview"></pre>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.2.6/dist/jalaali.min.js"></script>
    <script>
        // Configuration
        let config = {
            maxHistory: 30,
            autoBackup: true
        };
        
        let materialRates = {
            rebar8: 736,
            rebar12: 758,
            rebar20: 250,
            superplasticizer: 45
        };

        let reportHistory = [];
        let hasUnsavedChanges = false;

        const persianMonths = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'];
        const persianDays = ['ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡', 'Ø´Ù†Ø¨Ù‡'];

        let currentJalaliDate, selectedJalaliDate, calendarDisplayMonth, calendarDisplayYear;

        // Jalali Date Functions using jalaali-js library
        function toJalali(gy, gm, gd) {
            return jalaali.toJalaali(gy, gm, gd);
        }

        function toGregorian(jy, jm, jd) {
            return jalaali.toGregorian(jy, jm, jd);
        }

        function toPersianNumber(num) {
            const persianDigits = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
            return num.toString().replace(/\d/g, x => persianDigits[x]);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            currentJalaliDate = toJalali(now.getFullYear(), now.getMonth() + 1, now.getDate());
            selectedJalaliDate = { ...currentJalaliDate };
            calendarDisplayMonth = currentJalaliDate.month;
            calendarDisplayYear = currentJalaliDate.year;
            
            updateDateDisplay();
            updatePreview();
            loadSettings();
            loadHistory();
            
            document.getElementById('reportDate').addEventListener('click', toggleCalendar);
            document.querySelectorAll('input, textarea').forEach(el => {
                el.addEventListener('input', () => {
                    markAsUnsaved();
                    updatePreview();
                });
            });
            
            renderCalendar();
            loadFromLocalStorage();
            
            // Warn before closing if unsaved
            window.addEventListener('beforeunload', (e) => {
                if (hasUnsavedChanges) {
                    e.preventDefault();
                    e.returnValue = '';
                }
            });
        });

        function markAsUnsaved() {
            hasUnsavedChanges = true;
            document.getElementById('warningBox').style.display = 'block';
            document.getElementById('successBox').style.display = 'none';
        }

        function markAsSaved() {
            hasUnsavedChanges = false;
            document.getElementById('warningBox').style.display = 'none';
            document.getElementById('successBox').style.display = 'block';
            const now = new Date();
            document.getElementById('lastSaveInfo').textContent = 
                'Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ Ø¯Ø± ' + now.toLocaleTimeString('fa-IR');
        }

        // Backup and Save Functions
        function saveWithBackup() {
            if (config.autoBackup) {
                createBackup();
            }
            saveToLocalStorage();
            markAsSaved();
            showAlert('âœ“ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
        }

        function createBackup() {
            const backup = {
                timestamp: new Date().toISOString(),
                date: document.getElementById('reportDate').value,
                dayName: document.getElementById('dayName').value,
                ringsProduced: document.getElementById('ringsProduced').value,
                basketsProduced: document.getElementById('basketsProduced').value,
                monthlyProduction: document.getElementById('monthlyProduction').value,
                yearlyProduction: document.getElementById('yearlyProduction').value,
                totalProduction: document.getElementById('totalProduction').value,
                stock: {
                    rebar8: document.getElementById('rebar8Stock').value,
                    rebar12: document.getElementById('rebar12Stock').value,
                    rebar20: document.getElementById('rebar20Stock').value,
                    superplasticizer: document.getElementById('superplasticizerStock').value,
                    microsilica: document.getElementById('microsilicaStock').value
                },
                issues: document.getElementById('issues').value,
                suggestions: document.getElementById('suggestions').value
            };
            
            reportHistory.unshift(backup);
            
            // Keep only max history items
            if (reportHistory.length > config.maxHistory) {
                reportHistory = reportHistory.slice(0, config.maxHistory);
            }
            
            localStorage.setItem('reportHistory', JSON.stringify(reportHistory));
        }

        function loadHistory() {
            const saved = localStorage.getItem('reportHistory');
            if (saved) {
                reportHistory = JSON.parse(saved);
            }
        }

        function openHistory() {
            renderHistoryList();
            document.getElementById('historyModal').classList.add('show');
        }

        function closeHistory() {
            document.getElementById('historyModal').classList.remove('show');
        }

        function renderHistoryList() {
            const list = document.getElementById('historyList');
            
            if (reportHistory.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #6B7280; padding: 2rem;">Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ Ù‚Ø¨Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';
                return;
            }
            
            let html = '';
            reportHistory.forEach((item, index) => {
                const timestamp = new Date(item.timestamp);
                const isRecent = index === 0;
                
                html += '<div class="history-item' + (isRecent ? ' current' : '') + '" onclick="restoreFromHistory(' + index + ')">';
                html += '<div class="history-date">' + (item.date || 'Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÛŒØ®') + ' - ' + (item.dayName || '') + '</div>';
                html += '<div class="history-info">';
                html += '<span>ØªÙˆÙ„ÛŒØ¯: ' + toPersianNumber(item.ringsProduced || '0') + ' Ø±ÛŒÙ†Ú¯</span>';
                html += '<span>ØªØ¬Ù…Ø¹ÛŒ: ' + toPersianNumber(item.totalProduction || '0') + ' Ø±ÛŒÙ†Ú¯</span>';
                html += '<span>' + timestamp.toLocaleDateString('fa-IR') + ' ' + timestamp.toLocaleTimeString('fa-IR') + '</span>';
                html += '</div>';
                html += '</div>';
            });
            
            list.innerHTML = html;
        }

        function restoreFromHistory(index) {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ù„ÛŒ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.')) {
                return;
            }
            
            // Save current before restoring
            createBackup();
            
            const item = reportHistory[index];
            
            // Restore data
            if (item.date) {
                const parts = item.date.split('/');
                if (parts.length === 3) {
                    selectedJalaliDate = {
                        year: parseInt(parts[0]),
                        month: parseInt(parts[1]),
                        day: parseInt(parts[2])
                    };
                    updateDateDisplay();
                }
            }
            
            document.getElementById('ringsProduced').value = item.ringsProduced || '0';
            document.getElementById('basketsProduced').value = item.basketsProduced || '';
            document.getElementById('monthlyProduction').value = item.monthlyProduction || '0';
            document.getElementById('yearlyProduction').value = item.yearlyProduction || '0';
            document.getElementById('totalProduction').value = item.totalProduction || '0';
            
            if (item.stock) {
                document.getElementById('rebar8Stock').value = item.stock.rebar8 || '0';
                document.getElementById('rebar12Stock').value = item.stock.rebar12 || '0';
                document.getElementById('rebar20Stock').value = item.stock.rebar20 || '0';
                document.getElementById('superplasticizerStock').value = item.stock.superplasticizer || '0';
                document.getElementById('microsilicaStock').value = item.stock.microsilica || '0';
            }
            
            document.getElementById('issues').value = item.issues || '';
            document.getElementById('suggestions').value = item.suggestions || '';
            
            updatePreview();
            closeHistory();
            showAlert('âœ“ Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯', 'success');
        }

        function clearHistory() {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ')) {
                return;
            }
            
            reportHistory = [];
            localStorage.removeItem('reportHistory');
            renderHistoryList();
            showAlert('âœ“ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù¾Ø§Ú© Ø´Ø¯', 'success');
        }

        function exportHistory() {
            const data = {
                exportDate: new Date().toISOString(),
                history: reportHistory,
                config: config,
                materialRates: materialRates
            };
            
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'ØªØ§Ø±ÛŒØ®Ú†Ù‡-Ú¯Ø²Ø§Ø±Ø´Ø§Øª-' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            showAlert('âœ“ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØµØ§Ø¯Ø± Ø´Ø¯', 'success');
        }

        function setToday() {
            const now = new Date();
            currentJalaliDate = toJalali(now.getFullYear(), now.getMonth() + 1, now.getDate());
            selectedJalaliDate = { ...currentJalaliDate };
            calendarDisplayMonth = currentJalaliDate.month;
            calendarDisplayYear = currentJalaliDate.year;
            updateDateDisplay();
            renderCalendar();
        }

        // Calendar Functions
        function updateDateDisplay() {
            const jalali = selectedJalaliDate;
            const gregorian = toGregorian(jalali.year, jalali.month, jalali.day);
            const date = new Date(gregorian.gy, gregorian.gm - 1, gregorian.gd);
            const dayOfWeek = date.getDay();
            
            document.getElementById('reportDate').value = 
                toPersianNumber(jalali.year) + '/' + 
                toPersianNumber(jalali.month.toString().padStart(2, '0')) + '/' + 
                toPersianNumber(jalali.day.toString().padStart(2, '0'));
            
            document.getElementById('dayName').value = persianDays[dayOfWeek];
            
            const isToday = jalali.year === currentJalaliDate.year && 
                           jalali.month === currentJalaliDate.month && 
                           jalali.day === currentJalaliDate.day;
            const badge = document.getElementById('todayBadge');
            badge.textContent = isToday ? 'âœ“ Ø§Ù…Ø±ÙˆØ²' : 'ğŸ“… Ø§Ù…Ø±ÙˆØ²';
            
            updatePreview();
        }

        function toggleCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.classList.toggle('show');
            if (calendar.classList.contains('show')) renderCalendar();
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            let html = '<div class="calendar-header">';
            html += '<button onclick="previousMonth()">â—€</button>';
            html += '<div class="calendar-title">' + persianMonths[calendarDisplayMonth - 1] + ' ' + toPersianNumber(calendarDisplayYear) + '</div>';
            html += '<button onclick="nextMonth()">â–¶</button></div>';
            
            html += '<div class="calendar-weekdays">';
            ['Ø´', 'ÛŒ', 'Ø¯', 'Ø³', 'Ú†', 'Ù¾', 'Ø¬'].forEach(day => {
                html += '<div class="calendar-weekday">' + day + '</div>';
            });
            html += '</div><div class="calendar-days">';
            
            const firstDayOfMonth = toGregorian(calendarDisplayYear, calendarDisplayMonth, 1);
            const firstDate = new Date(firstDayOfMonth.gy, firstDayOfMonth.gm - 1, firstDayOfMonth.gd);
            const firstDayOfWeek = (firstDate.getDay() + 1) % 7;
            const daysInMonth = calendarDisplayMonth <= 6 ? 31 : (calendarDisplayMonth <= 11 ? 30 : 29);
            
            for (let i = 0; i < firstDayOfWeek; i++) {
                html += '<div class="calendar-day other-month"></div>';
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const isSelected = day === selectedJalaliDate.day && 
                                 calendarDisplayMonth === selectedJalaliDate.month && 
                                 calendarDisplayYear === selectedJalaliDate.year;
                const isToday = day === currentJalaliDate.day && 
                               calendarDisplayMonth === currentJalaliDate.month && 
                               calendarDisplayYear === currentJalaliDate.year;
                
                let classes = 'calendar-day';
                if (isSelected) classes += ' selected';
                if (isToday) classes += ' today';
                
                html += '<div class="' + classes + '" onclick="selectDate(' + day + ')">' + 
                        toPersianNumber(day) + '</div>';
            }
            
            html += '</div>';
            calendar.innerHTML = html;
        }

        function selectDate(day) {
            selectedJalaliDate = { year: calendarDisplayYear, month: calendarDisplayMonth, day: day };
            updateDateDisplay();
            toggleCalendar();
            markAsUnsaved();
        }

        function previousMonth() {
            calendarDisplayMonth--;
            if (calendarDisplayMonth < 1) {
                calendarDisplayMonth = 12;
                calendarDisplayYear--;
            }
            renderCalendar();
        }

        function nextMonth() {
            calendarDisplayMonth++;
            if (calendarDisplayMonth > 12) {
                calendarDisplayMonth = 1;
                calendarDisplayYear++;
            }
            renderCalendar();
        }

        // Stock Calculation
        function calculateStockDetails() {
            const ringsProduced = parseFloat(document.getElementById('ringsProduced').value) || 0;
            
            const rebar8Stock = parseFloat(document.getElementById('rebar8Stock').value) || 0;
            const rebar12Stock = parseFloat(document.getElementById('rebar12Stock').value) || 0;
            const rebar20Stock = parseFloat(document.getElementById('rebar20Stock').value) || 0;
            const superplasticizerStock = parseFloat(document.getElementById('superplasticizerStock').value) || 0;
            
            const rebar8Used = ringsProduced * materialRates.rebar8;
            const rebar12Used = ringsProduced * materialRates.rebar12;
            const rebar20Used = ringsProduced * materialRates.rebar20;
            const superplasticizerUsed = ringsProduced * materialRates.superplasticizer;
            
            const rebar8Remaining = Math.max(0, rebar8Stock - rebar8Used);
            const rebar12Remaining = Math.max(0, rebar12Stock - rebar12Used);
            const rebar20Remaining = Math.max(0, rebar20Stock - rebar20Used);
            const superplasticizerRemaining = Math.max(0, superplasticizerStock - superplasticizerUsed);
            
            const rebar8Capacity = Math.floor(rebar8Remaining / materialRates.rebar8);
            const rebar12Capacity = Math.floor(rebar12Remaining / materialRates.rebar12);
            const rebar20Capacity = Math.floor(rebar20Remaining / materialRates.rebar20);
            const superplasticizerCapacity = Math.floor(superplasticizerRemaining / materialRates.superplasticizer);
            
            return {
                rebar8: { used: rebar8Used, remaining: rebar8Remaining, capacity: rebar8Capacity },
                rebar12: { used: rebar12Used, remaining: rebar12Remaining, capacity: rebar12Capacity },
                rebar20: { used: rebar20Used, remaining: rebar20Remaining, capacity: rebar20Capacity },
                superplasticizer: { used: superplasticizerUsed, remaining: superplasticizerRemaining, capacity: superplasticizerCapacity }
            };
        }

        function updateStockDisplay() {
            const details = calculateStockDetails();
            const stockDisplay = document.getElementById('stockDisplay');
            
            const items = [
                { title: 'Ù…ÛŒÙ„Ú¯Ø±Ø¯ Û¸', data: details.rebar8, threshold: 10 },
                { title: 'Ù…ÛŒÙ„Ú¯Ø±Ø¯ Û±Û²', data: details.rebar12, threshold: 10 },
                { title: 'Ù…ÛŒÙ„Ú¯Ø±Ø¯ Û²Û°', data: details.rebar20, threshold: 10 },
                { title: 'ÙÙˆÙ‚ Ø±ÙˆØ§Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡', data: details.superplasticizer, threshold: 15 }
            ];
            
            let html = '';
            items.forEach(item => {
                const status = item.data.capacity < 5 ? 'low' : item.data.capacity < item.threshold ? 'warning' : '';
                
                html += '<div class="stock-item ' + status + '">';
                html += '<div class="stock-item-title">' + item.title + '</div>';
                html += '<div class="stock-item-value">' + toPersianNumber(item.data.capacity) + ' Ø±ÛŒÙ†Ú¯</div>';
                html += '<div class="stock-item-detail">Ù…ØµØ±Ù: ' + toPersianNumber(Math.round(item.data.used)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</div>';
                html += '<div class="stock-item-detail">Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ' + toPersianNumber(Math.round(item.data.remaining)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</div>';
                html += '</div>';
            });
            
            stockDisplay.innerHTML = html;
        }

        // Report Generation
        function generateReport() {
            const date = document.getElementById('reportDate').value;
            const day = document.getElementById('dayName').value;
            const ringsProduced = document.getElementById('ringsProduced').value || 'Û°';
            const basketsProduced = document.getElementById('basketsProduced').value || 'â€”';
            const monthlyProduction = document.getElementById('monthlyProduction').value || 'Û°';
            const yearlyProduction = document.getElementById('yearlyProduction').value || 'Û°';
            const totalProduction = document.getElementById('totalProduction').value || 'Û°';
            const issues = document.getElementById('issues').value || 'Ù…ÙˆØ±Ø¯ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.';
            const suggestions = document.getElementById('suggestions').value || 'Ù…ÙˆØ±Ø¯ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.';
            
            const details = calculateStockDetails();
            
            let report = 'ğŸ”´ Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø±Ø®Ø§Ù†Ù‡ ØªÙˆÙ„ÛŒØ¯ Ø³Ú¯Ù…Ù†Øª\n';
            report += 'Ù¾Ø±ÙˆÚ˜Ù‡ Ø®Ø· Û±Û° Ù…ØªØ±Ùˆ ØªÙ‡Ø±Ø§Ù†\n';
            report += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            report += 'ğŸ“… ØªØ§Ø±ÛŒØ®: ' + date + ' (' + day + ')\n\n';
            
            report += 'ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙˆÙ„ÛŒØ¯:\n';
            report += 'â–«ï¸ ØªÙˆÙ„ÛŒØ¯ Ø±ÙˆØ²: ' + toPersianNumber(ringsProduced) + ' Ø±ÛŒÙ†Ú¯\n';
            if (basketsProduced !== 'â€”') {
                report += 'â–«ï¸ Ø³Ø¨Ø¯ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡: ' + toPersianNumber(basketsProduced) + ' Ø±ÛŒÙ†Ú¯\n';
            }
            report += 'â–«ï¸ ØªÙˆÙ„ÛŒØ¯ Ù…Ø§Ù‡: ' + toPersianNumber(monthlyProduction) + ' Ø±ÛŒÙ†Ú¯\n';
            report += 'â–«ï¸ ØªÙˆÙ„ÛŒØ¯ Ø³Ø§Ù„ Û±Û´Û°Û´: ' + toPersianNumber(yearlyProduction) + ' Ø±ÛŒÙ†Ú¯\n';
            report += 'â–«ï¸ ØªÙˆÙ„ÛŒØ¯ ØªØ¬Ù…Ø¹ÛŒ Ú©Ù„: ' + toPersianNumber(totalProduction) + ' Ø±ÛŒÙ†Ú¯\n\n';
            
            report += 'ğŸ“¦ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ùˆ Ù…ØµØ±Ù Ù…ÙˆØ§Ø¯:\n';
            report += 'â–«ï¸ Ù…ÛŒÙ„Ú¯Ø±Ø¯ Û¸:\n';
            report += '   â€¢ Ù…ØµØ±Ù Ø±ÙˆØ²: ' + toPersianNumber(Math.round(details.rebar8.used)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…\n';
            report += '   â€¢ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ' + toPersianNumber(Math.round(details.rebar8.remaining)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…\n';
            report += '   â€¢ Ø¸Ø±ÙÛŒØª: ' + toPersianNumber(details.rebar8.capacity) + ' Ø±ÛŒÙ†Ú¯\n\n';
            
            report += 'â–«ï¸ Ù…ÛŒÙ„Ú¯Ø±Ø¯ Û±Û²:\n';
            report += '   â€¢ Ù…ØµØ±Ù Ø±ÙˆØ²: ' + toPersianNumber(Math.round(details.rebar12.used)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…\n';
            report += '   â€¢ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ' + toPersianNumber(Math.round(details.rebar12.remaining)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…\n';
            report += '   â€¢ Ø¸Ø±ÙÛŒØª: ' + toPersianNumber(details.rebar12.capacity) + ' Ø±ÛŒÙ†Ú¯\n\n';
            
            report += 'â–«ï¸ Ù…ÛŒÙ„Ú¯Ø±Ø¯ Û²Û°:\n';
            report += '   â€¢ Ù…ØµØ±Ù Ø±ÙˆØ²: ' + toPersianNumber(Math.round(details.rebar20.used)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…\n';
            report += '   â€¢ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ' + toPersianNumber(Math.round(details.rebar20.remaining)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…\n';
            report += '   â€¢ Ø¸Ø±ÙÛŒØª: ' + toPersianNumber(details.rebar20.capacity) + ' Ø±ÛŒÙ†Ú¯\n\n';
            
            report += 'â–«ï¸ ÙÙˆÙ‚ Ø±ÙˆØ§Ù†â€ŒÚ©Ù†Ù†Ø¯Ù‡:\n';
            report += '   â€¢ Ù…ØµØ±Ù Ø±ÙˆØ²: ' + toPersianNumber(Math.round(details.superplasticizer.used)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…\n';
            report += '   â€¢ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡: ' + toPersianNumber(Math.round(details.superplasticizer.remaining)) + ' Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…\n';
            report += '   â€¢ Ø¸Ø±ÙÛŒØª: ' + toPersianNumber(details.superplasticizer.capacity) + ' Ø±ÛŒÙ†Ú¯\n\n';
            
            report += 'âš ï¸ Ù…Ø´Ú©Ù„Ø§Øª Ùˆ Ù…ÙˆØ§Ù†Ø¹:\n' + issues + '\n\n';
            report += 'ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª:\n' + suggestions + '\n';
            
            return report;
        }

        function updatePreview() {
            updateStockDisplay();
            document.getElementById('preview').textContent = generateReport();
        }

        function copyReport() {
            const report = generateReport();
            navigator.clipboard.writeText(report).then(() => {
                showAlert('âœ“ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù¾ÛŒ Ø´Ø¯!', 'success');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = report;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showAlert('âœ“ Ú¯Ø²Ø§Ø±Ø´ Ú©Ù¾ÛŒ Ø´Ø¯!', 'success');
            });
        }

        function downloadReport() {
            const report = generateReport();
            const date = document.getElementById('reportDate').value.replace(/\//g, '-');
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Ú¯Ø²Ø§Ø±Ø´-Ø³Ú¯Ù…Ù†Øª-' + date + '.txt';
            link.click();
        }

        function saveToLocalStorage() {
            const data = {
                lastUpdate: new Date().toISOString(),
                date: document.getElementById('reportDate').value,
                dayName: document.getElementById('dayName').value,
                ringsProduced: document.getElementById('ringsProduced').value,
                basketsProduced: document.getElementById('basketsProduced').value,
                monthlyProduction: document.getElementById('monthlyProduction').value,
                yearlyProduction: document.getElementById('yearlyProduction').value,
                totalProduction: document.getElementById('totalProduction').value,
                stock: {
                    rebar8: document.getElementById('rebar8Stock').value,
                    rebar12: document.getElementById('rebar12Stock').value,
                    rebar20: document.getElementById('rebar20Stock').value,
                    superplasticizer: document.getElementById('superplasticizerStock').value,
                    microsilica: document.getElementById('microsilicaStock').value
                },
                issues: document.getElementById('issues').value,
                suggestions: document.getElementById('suggestions').value
            };
            localStorage.setItem('currentReport', JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('currentReport');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    if (data.date) {
                        const parts = data.date.split('/');
                        if (parts.length === 3) {
                            selectedJalaliDate = {
                                year: parseInt(parts[0]),
                                month: parseInt(parts[1]),
                                day: parseInt(parts[2])
                            };
                            updateDateDisplay();
                        }
                    }
                    
                    document.getElementById('ringsProduced').value = data.ringsProduced || '0';
                    document.getElementById('basketsProduced').value = data.basketsProduced || '';
                    document.getElementById('monthlyProduction').value = data.monthlyProduction || '0';
                    document.getElementById('yearlyProduction').value = data.yearlyProduction || '0';
                    document.getElementById('totalProduction').value = data.totalProduction || '0';
                    
                    if (data.stock) {
                        document.getElementById('rebar8Stock').value = data.stock.rebar8 || '0';
                        document.getElementById('rebar12Stock').value = data.stock.rebar12 || '0';
                        document.getElementById('rebar20Stock').value = data.stock.rebar20 || '0';
                        document.getElementById('superplasticizerStock').value = data.stock.superplasticizer || '0';
                        document.getElementById('microsilicaStock').value = data.stock.microsilica || '0';
                    }
                    
                    document.getElementById('issues').value = data.issues || '';
                    document.getElementById('suggestions').value = data.suggestions || '';
                    
                    updatePreview();
                } catch (e) {
                    console.error('Error loading from localStorage:', e);
                }
            }
        }

        // Settings Functions
        function openSettings() {
            document.getElementById('settingsModal').classList.add('show');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }

        function saveSettings() {
            materialRates.rebar8 = parseFloat(document.getElementById('setting_rebar8').value) || 736;
            materialRates.rebar12 = parseFloat(document.getElementById('setting_rebar12').value) || 758;
            materialRates.rebar20 = parseFloat(document.getElementById('setting_rebar20').value) || 250;
            materialRates.superplasticizer = parseFloat(document.getElementById('setting_superplasticizer').value) || 45;
            
            config.maxHistory = parseInt(document.getElementById('setting_maxHistory').value) || 30;
            config.autoBackup = document.getElementById('setting_autoBackup').value === 'true';
            
            updateMaterialRatesDisplay();
            localStorage.setItem('materialRates', JSON.stringify(materialRates));
            localStorage.setItem('config', JSON.stringify(config));
            
            // Update backup badge
            const badge = document.getElementById('backupBadge');
            badge.textContent = config.autoBackup ? 'ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÙØ¹Ø§Ù„' : 'âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ØºÛŒØ±ÙØ¹Ø§Ù„';
            badge.className = config.autoBackup ? 'badge success' : 'badge';
            
            updatePreview();
            closeSettings();
            showAlert('âœ“ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
        }

        function loadSettings() {
            const savedRates = localStorage.getItem('materialRates');
            if (savedRates) {
                materialRates = JSON.parse(savedRates);
                updateMaterialRatesDisplay();
            }
            
            const savedConfig = localStorage.getItem('config');
            if (savedConfig) {
                config = JSON.parse(savedConfig);
                document.getElementById('setting_maxHistory').value = config.maxHistory;
                document.getElementById('setting_autoBackup').value = config.autoBackup.toString();
                
                const badge = document.getElementById('backupBadge');
                badge.textContent = config.autoBackup ? 'ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÙØ¹Ø§Ù„' : 'âš ï¸ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ØºÛŒØ±ÙØ¹Ø§Ù„';
                badge.className = config.autoBackup ? 'badge success' : 'badge';
            }
        }

        function updateMaterialRatesDisplay() {
            document.getElementById('setting_rebar8').value = materialRates.rebar8;
            document.getElementById('setting_rebar12').value = materialRates.rebar12;
            document.getElementById('setting_rebar20').value = materialRates.rebar20;
            document.getElementById('setting_superplasticizer').value = materialRates.superplasticizer;
            
            document.getElementById('display_rebar8').textContent = toPersianNumber(materialRates.rebar8);
            document.getElementById('display_rebar12').textContent = toPersianNumber(materialRates.rebar12);
            document.getElementById('display_rebar20').textContent = toPersianNumber(materialRates.rebar20);
            document.getElementById('display_superplasticizer').textContent = toPersianNumber(materialRates.superplasticizer);
        }

        // UI Functions
        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = 'alert ' + type;
            alert.classList.add('show');
            setTimeout(() => alert.classList.remove('show'), 3000);
        }

        // Close modals on outside click
        document.addEventListener('click', function(e) {
            const calendar = document.getElementById('calendar');
            const dateInput = document.getElementById('reportDate');
            if (calendar && !calendar.contains(e.target) && e.target !== dateInput) {
                calendar.classList.remove('show');
            }
            
            const settingsModal = document.getElementById('settingsModal');
            if (e.target === settingsModal) closeSettings();
            
            const historyModal = document.getElementById('historyModal');
            if (e.target === historyModal) closeHistory();
        });
    </script>
</body>
</html>
